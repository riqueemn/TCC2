#include <Arduino.h>

// Define os pinos da Serial2
#define SERIAL2_RX_PIN 16 // GPIO16
#define SERIAL2_TX_PIN 17 // GPIO17
#define LED 2 //GPIO
#define TRANC_485 4 // Pino de Transmissão

char valor_lido;
char retorno_MODBUS;

void setup() {
  // Inicializa a comunicação serial para monitoramento
  Serial.begin(9600);
  // Inicializa a comunicação serial2
  Serial2.begin(9600, SERIAL_8N1, SERIAL2_RX_PIN, SERIAL2_TX_PIN);
  //Inicializa LED2
  pinMode(LED,OUTPUT);
  pinMode(TRANC_485,OUTPUT);
}

void loop() {
  if(Serial.available()>0){
    
    // Lê o byte de dados da porta serial COM5
    valor_lido = Serial.read();
    
    // Envia o byte de dados para a porta serial2
    digitalWrite(TRANC_485,LOW);
    Serial2.write(valor_lido);
  
    // Imprime o dado na porta serial USB para monitoramento
    Serial.print("Dado recebido da COM5 e enviado pela Serial2: ");
    Serial.println(valor_lido);
    digitalWrite(LED,HIGH);
    delay(10);
    digitalWrite(LED,LOW);
    delay(10);
    digitalWrite(TRANC_485,HIGH);
    delay(10);
  }

    if(Serial2.available()>0){
    digitalWrite(LED,HIGH);
    digitalWrite(TRANC_485,HIGH);
    delay(10);
    retorno_MODBUS = Serial2.read();
    delay(10);
    Serial.println(retorno_MODBUS);
    }
  }